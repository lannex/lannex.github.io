{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/2020/EFK-Fluentd-Fluentbit/",
    "result": {"data":{"site":{"siteMetadata":{"title":"lannex"}},"markdownRemark":{"id":"222626ff-b6de-5bd4-977b-b70da6fd24a0","excerpt":"í˜„ì¬ ì‚¬ë‚´ì—ì„œëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ë¡œ Docker Swarmì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. Kubernetes ì „í™˜ ì–˜ê¸°ê°€ ì†”ì†” ë‚˜ì˜¤ëŠ” ì™€ì¤‘ì— ìƒˆë¡œìš´ í”„ë¡œë•íŠ¸ë¥¼ ë‚´ë†“ê²Œ ë˜ì—ˆëŠ”ë° ì´ ê³¼ì •ì—ì„œ EFKë¥¼ ì‚¬ìš©í•˜ì—¬ Loggingì„ êµ¬ì¶•í•œ ê²½í—˜, íŠ¹íˆ Fluent Bitê³¼ Fluentdâ€¦","html":"<p>í˜„ì¬ ì‚¬ë‚´ì—ì„œëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ë¡œ Docker Swarmì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. Kubernetes ì „í™˜ ì–˜ê¸°ê°€ ì†”ì†” ë‚˜ì˜¤ëŠ” ì™€ì¤‘ì— ìƒˆë¡œìš´ í”„ë¡œë•íŠ¸ë¥¼ ë‚´ë†“ê²Œ ë˜ì—ˆëŠ”ë° ì´ ê³¼ì •ì—ì„œ EFKë¥¼ ì‚¬ìš©í•˜ì—¬ Loggingì„ êµ¬ì¶•í•œ ê²½í—˜, íŠ¹íˆ Fluent Bitê³¼ Fluentdë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê¸°ë³¸ ì„¤ì •ì— ê´€í•´ ì´ì•¼ê¸°í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤.</p>\n<h2 id=\"-elkì™€-efk-stack\" style=\"position:relative;\"><a href=\"#-elk%EC%99%80-efk-stack\" aria-label=\" elkì™€ efk stack permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ‘€ ELKì™€ EFK Stack?</h2>\n<p>EFKë€ Elasticsearch, Fluentd ê·¸ë¦¬ê³  Kibanaì˜ ì²« ê¸€ìë¥¼ ë”´ ì•½ìì…ë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ ì•Œë ¤ì§„ ELKëŠ” Elasticsearch, Logstash ì™€ Kibanaì˜ ì•½ìì´ë©° ë‘ Stackì˜ ì°¨ì´ë¡œëŠ” ë¡œê·¸ ìˆ˜ì§‘ê¸°ë¥¼ Fluentdë¡œ ì‚¬ìš©í•  ê²ƒì¸ì§€ ì•„ë‹ˆë©´ Logstashë¡œ ì‚¬ìš©í•  ê²ƒì¸ì§€ ë§ê³ ëŠ” ì—†ìŠµë‹ˆë‹¤.</p>\n<p>í•œ ë‹¨ê³„ ë” ê°€ì„œ Logstashì™€ Fluentdì˜ ì°¨ì´ì ì„ ì–˜ê¸°í•´ë³´ìë©´ LogstashëŠ” ìë°” ëŸ°íƒ€ì„ì´ í•„ìš”í•œ JRubyë¡œ ë˜ì–´ìˆìœ¼ë©° FluentdëŠ” ìë°” ëŸ°íƒ€ì„ì´ í•„ìš”í•˜ì§€ ì•Šì€ CRubyë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  Logstashì— ë¹„í•´ FluentdëŠ” ì¡°ê¸ˆ ë” ê°€ë²¼ìš°ë©° ë•Œì— ë”°ë¼ ë¡œê·¸ ì „ì†¡ë§Œ ë‹´ë‹¹í•˜ëŠ”, ë”ìš± ê²½ëŸ‰í™”ëœ Fluent Bitì„ ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2 id=\"-architecture\" style=\"position:relative;\"><a href=\"#-architecture\" aria-label=\" architecture permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ“ Architecture</h2>\n<p>ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d14a60a80d68a075a37921dbb069e115/eea4a/efk.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHutEil/8QAGBAAAgMAAAAAAAAAAAAAAAAAABEBICH/2gAIAQEAAQUCesin/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAACAx/9oACAEBAAY/AiL/AP/EABoQAAMBAAMAAAAAAAAAAAAAAAERIQAgMWH/2gAIAQEAAT8hZo7mtd4iQyF5w//aAAwDAQACAAMAAAAQf8//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxCH/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QZ//EABkQAQEBAQEBAAAAAAAAAAAAAAERACFBUf/aAAgBAQABPxAg8CeeEuQFeQFOn3A0t9eaHeaYJv/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EFK\"\n        title=\"EFK\"\n        src=\"/static/d14a60a80d68a075a37921dbb069e115/4b190/efk.jpg\"\n        srcset=\"/static/d14a60a80d68a075a37921dbb069e115/e07e9/efk.jpg 200w,\n/static/d14a60a80d68a075a37921dbb069e115/066f9/efk.jpg 400w,\n/static/d14a60a80d68a075a37921dbb069e115/4b190/efk.jpg 800w,\n/static/d14a60a80d68a075a37921dbb069e115/e5166/efk.jpg 1200w,\n/static/d14a60a80d68a075a37921dbb069e115/eea4a/efk.jpg 1280w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ê° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¡œ êµ¬ì„±ëœ ì„œë²„ì— Fluent Bitìœ¼ë¡œ logë¥¼ ìˆ˜ì§‘ í›„ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ê°€ ê°€ëŠ¥í•œ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë°›ëŠ” ì„œë²„ì—ì„œëŠ” Fluentdë¥¼ Aggregatorì˜ ì—­í• ë¡œ êµ¬ì„±í•˜ê³  ë‹¤ì‹œ Elasticsearchë¡œ ë°ì´í„°ë¥¼ ì „ì†¡, KibanaëŠ” Elasticsearchì˜ ë°ì´í„°ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.</p>\n<h2 id=\"-fluent-bitê³¼-fluentd\" style=\"position:relative;\"><a href=\"#-fluent-bit%EA%B3%BC-fluentd\" aria-label=\" fluent bitê³¼ fluentd permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ¤² Fluent Bitê³¼ Fluentd</h2>\n<p>ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ Fluent Bitì€ Fluentdì˜ ê²½ëŸ‰í™”ëœ ë²„ì „ìœ¼ë¡œ Cë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. ì„œë²„ í™˜ê²½ì´ ì›Œë‚™ ì¢‹ì•„ì ¸ì„œ í¬ê²Œ ìƒê´€ì€ ì—†ì§€ë§Œ ì„œë²„ì—ì„œ Forwarderë§Œ ë‹´ë‹¹í•œë‹¤ë©´ ì¢€ ë” ê°€ë²¼ìš´ Fluent Bitì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>\n<h2 id=\"-input--parser--filter--output\" style=\"position:relative;\"><a href=\"#-input--parser--filter--output\" aria-label=\" input  parser  filter  output permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ‘‰ Input â†’ Parser â†’ Filter â†’ Output</h2>\n<p>Fluent Bitê³¼ Fluentdì˜ íŒŒì´í”„ë¼ì¸ì€ ì¤‘ê°„ì¤‘ê°„ ì¶”ê°€ë˜ëŠ” ê³¼ì •ì´ ìˆì–´ì„œ ì¡°ê¸ˆì€ ë‹¤ë¥´ì§€ë§Œ í¬ê²ŒëŠ” ì´ëŸ¬í•œ ê³¼ì •ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.</p>\n<ol>\n<li>Input: ì„œë¡œ ë‹¤ë¥¸ ì†ŒìŠ¤ì—ì„œ ì–´ë–¤ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•  ì§€ ê²°ì •</li>\n<li>Parser: ìˆ˜ì§‘í•˜ëŠ” ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•˜ëŠ” íŒŒì‹±</li>\n<li>Filter: ë°ì´í„°ë¥¼ íŠ¹ì • ëŒ€ìƒìœ¼ë¡œ ì „ë‹¬í•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ê°€ê³µ</li>\n<li>Output: ê°€ê³µëœ ë°ì´í„°ë¥¼ ë‚´ë³´ë‚´ëŠ” ë°©ì‹ì„ ì •ì˜</li>\n</ol>\n<p>ê° ê³¼ì •ì—ì„œ ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ì¸ë“¤ì´ ì œê³µë˜ë©° ì„¤ì •ì„ ì •ì˜í•¨ìœ¼ë¡œì¨ ì›í•˜ëŠ” ê°’ì„ ë„ì¶œí•˜ê²Œë” ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2 id=\"-forwarder-fluent-bit\" style=\"position:relative;\"><a href=\"#-forwarder-fluent-bit\" aria-label=\" forwarder fluent bit permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸš¢ Forwarder (Fluent Bit)</h2>\n<p>í”„ë¡œë•íŠ¸ëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ on-premise í˜•íƒœë¡œ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¡œ êµ¬ì„±ëœ ì„œë²„ì—ëŠ” Docker Swarmìœ¼ë¡œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë˜ë‹ˆ ë¨¼ì € ë§ì€ Dockerë“¤ì˜ Logë¥¼ ì¶”ì í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. (Ubuntu ê¸°ì¤€ìœ¼ë¡œ Docker Log ìœ„ì¹˜ëŠ” <code class=\"language-text\">/var/lib/docker/containers/&lt;container id>/&lt;container id>-json.log</code>)</p>\n<p>ê° í´ë¼ì´ì–¸íŠ¸ ì„œë²„ì—ì„  Forwarderë¡œë§Œ ì‚¬ìš©í•˜ê¸°ì— Docker Buildë¡œ Fluent Bitë¥¼ ì„¤ì •í•˜ì—¬ ì„œë¹„ìŠ¤í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\"># inputs.conf</span>\n\n[INPUT]\n<span class=\"token attr-name\">  Name</span> <span class=\"token attr-value\">             tail</span>\n<span class=\"token attr-name\">  Parser</span> <span class=\"token attr-value\">           docker</span>\n<span class=\"token attr-name\">  Path</span> <span class=\"token attr-value\">             /var/lib/docker/containers/*/*.log</span>\n<span class=\"token attr-name\">  Docker_Mode</span> <span class=\"token attr-value\">      On</span>\n<span class=\"token attr-name\">  Tag</span> <span class=\"token attr-value\">              docker.&lt;file_name></span>\n<span class=\"token attr-name\">  Tag_Regex</span> <span class=\"token attr-value\">        (?&lt;file_name>[a-z0-9]*)-json.log</span>\n\t...</code></pre></div>\n<p>Loggingì€ Docker ì™¸ì—ë„ ì—¬ëŸ¬ ê°œ Inputì„ ì‘ì„±í•˜ë‹¤ ë³´ë©´ ì„¤ì • íŒŒì¼ì´ ê¸¸ì–´ì§€ê²Œ ë©ë‹ˆë‹¤. ê±°ê¸°ì—ë‹¤ ê°ì¢… Filter ë“± ë‹¤ë¥¸ ê³¼ì •ê¹Œì§€ í¬í•¨í•˜ë‹¤ ë³´ë©´ í•˜ë‚˜ì˜ ì„¤ì • íŒŒì¼ì— ê°ë‹¹í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê° ê³¼ì •ì„  <code class=\"language-text\">@INCLUDE</code> ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ íŒŒì¼ë¡œ ëª¨ë“ˆí™”ë¥¼ í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\"># fluent-bit.conf</span>\n\n<span class=\"token attr-name\">@INCLUDE</span> <span class=\"token attr-value\">/fluent-bit/etc/inputs.conf</span>\n\n<span class=\"token attr-name\">@INCLUDE</span> <span class=\"token attr-value\">/fluent-bit/etc/filters.conf</span>\n\n...</code></pre></div>\n<p>Docker Logë¥¼ ì´ë ‡ê²Œ ìˆ˜ì§‘í•œ ë’¤ ì—¬ëŸ¬ Filterë¥¼ ê±°ì³ì„œ ë°ì´í„°ë¥¼ ì›í•˜ëŠ” í˜•íƒœë¡œ ê°€ê³µí•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ°ê³ ë¡œ Filterì•¼ë§ë¡œ í•µì‹¬ì´ë¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ë¬´ì—‡ë³´ë‹¤ Input ì„¤ì •ì—ì„œ Tagë¥¼ <code class=\"language-text\">container id (file_name)</code> ë¡œ ë°›ê¸° ë•Œë¬¸ì— ê° Dockerì—ì„œ ë‚˜ì˜¤ëŠ” Logë¥¼ ì¸ì‹í•  ìˆ˜ ìˆëŠ” ê°’ìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ docker_metadataë¥¼ ë§¤ì¹­í•œ ë’¤ íƒœê·¸ë¥¼ ë³€ê²½í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ í•„í„°ë§í•©ë‹ˆë‹¤.(ì°¸ê³  <a href=\"https://github.com/fluent/fluent-bit/issues/1499\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">lua script</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\"># filters.conf</span>\n\n[FILTER]\n<span class=\"token attr-name\">  Name</span> <span class=\"token attr-value\">             lua</span>\n<span class=\"token attr-name\">  Match</span> <span class=\"token attr-value\">            docker.*</span>\n<span class=\"token attr-name\">  script</span> <span class=\"token attr-value\">           /fluent-bit/bin/docker-metadata.lua</span>\n<span class=\"token attr-name\">  call</span> <span class=\"token attr-value\">             encrich_with_docker_metadata</span>\n\n[FILTER]\n<span class=\"token attr-name\">  Name</span> <span class=\"token attr-value\">             record_modifier</span>\n<span class=\"token attr-name\">  Match</span> <span class=\"token attr-value\">            docker.*</span>\n<span class=\"token attr-name\">  Whitelist_key</span> <span class=\"token attr-value\">    log</span>\n<span class=\"token attr-name\">  Whitelist_key</span> <span class=\"token attr-value\">    docker.container_name</span>\n  ...\n\n[FILTER]\n<span class=\"token attr-name\">  Name</span> <span class=\"token attr-value\">             modify</span>\n<span class=\"token attr-name\">  Match</span> <span class=\"token attr-value\">            docker.*</span>\n<span class=\"token attr-name\">  Rename</span> <span class=\"token attr-value\">           docker.container_name container_name</span>\n\t...\n\n[FILTER]\n<span class=\"token attr-name\">  Name</span> <span class=\"token attr-value\">             rewrite_tag</span>\n<span class=\"token attr-name\">  Match</span> <span class=\"token attr-value\">            docker.*</span>\n<span class=\"token attr-name\">  Rule</span> <span class=\"token attr-value\">             $container_name (.*) docker.$0 false</span>\n\n...</code></pre></div>\n<p>ë˜í•œ grepì„ ì¨ì„œ ì„ íƒì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì·¨í•˜ê±°ë‚˜ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\"># filters.conf</span>\n\n[FILTER]\n<span class=\"token attr-name\">  Name</span> <span class=\"token attr-value\">             grep</span>\n<span class=\"token attr-name\">  Match</span> <span class=\"token attr-value\">            docker.*</span>\n<span class=\"token attr-name\">  Exclude</span> <span class=\"token attr-value\">          container_name (.*fluent).+</span>\n  ...</code></pre></div>\n<p>ì´ í›„ Outputì— forwardë¡œ Aggregatorì—ê²Œ ë°ì´í„°ë¥¼ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.</p>\n<h2 id=\"-aggregator-fluentd\" style=\"position:relative;\"><a href=\"#-aggregator-fluentd\" aria-label=\" aggregator fluentd permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ—ƒ Aggregator (Fluentd)</h2>\n<p>ê° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì €ë§ˆë‹¤ ë³´ë‚´ì˜¤ëŠ” ë°ì´í„°ë¥¼ Fluentdê°€ ìˆ˜ì§‘í•´ì„œ Elasticsearchë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì´ ì—­í• ì€ í•œ ê³³ì—ì„œë§Œ ë‹´ë‹¹í•˜ë©° Elasticsearchì™€ Kibanaë¥¼ ê°™ì€ ì„œë²„ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•´ë„ ë©ë‹ˆë‹¤.</p>\n<p>Elasticsearchë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ Fluentdì˜ <code class=\"language-text\">fluent-plugin-elasticsearch</code>ë¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì˜ ì„¤ì¹˜ê°€ ìš°ì„ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># Dockerfile</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> fluent/fluentd:v1.11-1</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">USER</span> root</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apk add --no-cache --update --virtual .build-deps <span class=\"token operator\">\\</span>\n  sudo build-base ruby-dev <span class=\"token operator\">\\</span>\n  &amp;&amp; sudo gem install <span class=\"token operator\">\\</span>\n    fluent-plugin-concat <span class=\"token operator\">\\</span>\n    fluent-plugin-elasticsearch <span class=\"token operator\">\\</span>\n  &amp;&amp; apk del .build-deps <span class=\"token operator\">\\</span>\n  &amp;&amp; rm -rf /tmp/* /var/tmp/* /usr/lib/ruby/gems/*/cache/*.gem</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> conf/* /fluentd/etc/</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> entrypoint.sh /bin/</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> chmod +x /bin/entrypoint.sh</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">USER</span> fluent</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"># fluent.conf\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">docker.swarm_reception-api**</span><span class=\"token punctuation\">></span></span>\n  @type elasticsearch_dynamic\n  logstash_format true\n\tlogstash_prefix ${record['biz_client']}-reception-api\n\t...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n...</code></pre></div>\n<p>ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ì „ì†¡ë°›ìœ¼ë‹ˆ ì–´ë–¤ í´ë¼ì´ì–¸íŠ¸ì¸ì§€ ì‹ë³„í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. Forwarderê°€ ì‹ë³„í•  recordë¥¼ í•˜ë‚˜ ì§€ì •í•´ì„œ ë³´ë‚´ì£¼ë©´ typeì„ <code class=\"language-text\">elasticsearch_dynamic</code> ë¡œ ì„ ì–¸í•´ì„œ ìœ ë™ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ë‹¤ì¤‘ matchì™€ labelë“±ì„ í™œìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶„ë¥˜ í›„ Elasticsearchë¡œ ì „ì†¡í•˜ë©´ ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë“œë””ì–´ Kibanaì—ì„œ ì‹œê°í™”ê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p>\n<h2 id=\"-elasticsearchì™€-kibana\" style=\"position:relative;\"><a href=\"#-elasticsearch%EC%99%80-kibana\" aria-label=\" elasticsearchì™€ kibana permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ“Š Elasticsearchì™€ Kibana</h2>\n<p>Elasticsearchì™€ KibanaëŠ” ì§ì ‘ ì„¤ì¹˜í•´ì„œ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ ìµœê·¼ì—ëŠ” ì—¬ëŸ¬ í´ë¼ìš°ë“œì—ì„œ ì‰½ê²Œ ë°°í¬ê¹Œì§€ ìë™ìœ¼ë¡œ í•˜ëŠ” í™˜ê²½ì„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ë”êµ°ë‹¤ë‚˜ <a href=\"https://elastic.co\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">elastic.co</a>ì—ì„œëŠ” ì‚¬ì´íŠ¸ ë‚´ì—ì„œ í´ë¼ìš°ë“œë¡œ ìë™ ë°°í¬í•˜ê³  ë§¤ë‹ˆì§€ë¨¼íŠ¸ê¹Œì§€ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.</p>\n<p>ë°°í¬ í›„ Kibanaì— ì ‘ì†í•˜ì—¬ Stack Managementì—ì„œ Index Managementë¥¼ í™•ì¸í•´ë³´ë©´ indexê°€  <code class=\"language-text\">&lt;client_name>-&lt;docker_name>-&lt;date></code>ì˜ í˜•ì‹ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ë¥¼ í† ëŒ€ë¡œ Kibana ì¸ë±ìŠ¤ íŒ¨í„´ì„ ë§Œë“¤ë©´ EFKì˜ ê¸°ë³¸ ê³¼ì •ì€ ëì´ ë‚©ë‹ˆë‹¤.</p>\n<h2 id=\"-ëìœ¼ë¡œ\" style=\"position:relative;\"><a href=\"#-%EB%81%9D%EC%9C%BC%EB%A1%9C\" aria-label=\" ëìœ¼ë¡œ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ“ƒ ëìœ¼ë¡œ</h2>\n<p>í° Pipelineì€ ì´ë ‡ê²Œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” ë” ë‹¤ì–‘í•˜ê³  ë§ì€ Filterë“¤ê³¼ ì„¤ì •ë“¤ë¡œ ë‹¤ì†Œ ë³µì¡í•˜ê²Œ êµ¬ì„±ë©ë‹ˆë‹¤. ê·¸ë˜ë„ ì œëŒ€ë¡œ ê°€ê³µëœ ë°ì´í„°ë§Œ Elasticsearchë¡œ ì „ì†¡í•  ìˆ˜ ìˆë‹¤ë©´ Kibanaì—ì„œ ì •ë§ í¸í•˜ê²Œ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ëŸ¼ ì—¬ê¸°ê¹Œì§€ MSA, Docker Swarm Logginì„ ìœ„í•œ EFK ì˜€ìŠµë‹ˆë‹¤.</p>","frontmatter":{"title":"EFK Stack, ê·¸ ì¤‘ì— Fluentdì™€ Fluent Bit","date":"2020-12-15","description":"EFK Stackìœ¼ë¡œ Docker Swarm Logging êµ¬ì¶•","tags":"devops"}}},"pageContext":{"slug":"/blog/2020/EFK-Fluentd-Fluentbit/","previous":{"fields":{"slug":"/blog/2020/github-action/"},"frontmatter":{"title":"Github Actionsë¡œ ê°„ë‹¨í•œ Azure Static Web Page ë°°í¬"},"tableOfContents":"<ul>\n<li><a href=\"#-github-actions%EC%9D%B4%EB%9E%80\">ğŸ¤” Github Actionsì´ë€?</a></li>\n<li><a href=\"#-%EB%B9%A0%EB%A5%B8-%EC%8B%9C%EC%9E%91\">ğŸš€ ë¹ ë¥¸ ì‹œì‘</a></li>\n<li><a href=\"#%EF%B8%8F-yml-%EC%9E%91%EC%84%B1\">âœï¸ yml ì‘ì„±</a></li>\n<li><a href=\"#-%EB%A7%88%EC%BC%93-%ED%94%8C%EB%A0%88%EC%9D%B4%EC%8A%A4\">ğŸ“¦ ë§ˆì¼“ í”Œë ˆì´ìŠ¤</a></li>\n<li><a href=\"#%EF%B8%8F-azure-action\">â˜ï¸ Azure Action</a></li>\n<li><a href=\"#%EF%B8%8F-%ED%99%95%EC%9D%B8\">âœ”ï¸ í™•ì¸</a></li>\n<li><a href=\"#-%EB%81%9D%EC%9C%BC%EB%A1%9C\">ğŸ’­ ëìœ¼ë¡œ</a></li>\n</ul>"},"next":{"fields":{"slug":"/blog/2021/why-rust-is-a-modern-programming-language/"},"frontmatter":{"title":"Rustê°€ \"í˜„ëŒ€ì ì¸\" í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì¸ ì´ìœ  (ë²ˆì—­)"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%86%8C%EA%B0%9C\">ì†Œê°œ</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%98%84%EB%8C%80%EC%A0%81%EC%9D%B8%EC%9D%B4-%EB%AC%B4%EC%8A%A8-%EB%9C%BB%EC%9E%85%EB%8B%88%EA%B9%8C\">â€œí˜„ëŒ€ì ì¸â€ì´ ë¬´ìŠ¨ ëœ»ì…ë‹ˆê¹Œ?</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EC%A0%81-%ED%83%80%EC%9E%85\">ì •ì  íƒ€ì…</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%95%88%EC%A0%84%EC%84%B1\">ë©”ëª¨ë¦¬ ì•ˆì „ì„±</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%98%84%EB%8C%80%EC%A0%81%EC%9D%B8\">â€œí˜„ëŒ€ì ì¸â€</a></p>\n<ul>\n<li><a href=\"#%EB%B9%84%EA%B5%AC%EC%A1%B0%ED%99%94-destructuring\">ë¹„êµ¬ì¡°í™” (Destructuring)</a></li>\n<li><a href=\"#%ED%8C%A8%ED%84%B4-%EB%A7%A4%EC%B9%AD-pattern-matching\">íŒ¨í„´ ë§¤ì¹­ (Pattern matching)</a></li>\n<li><a href=\"#%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9C%BC%EB%A1%9C-%EB%B6%88%EB%B3%80%EC%84%B1--%EC%84%80%EB%8F%84%EC%9E%89-immutability-by-default--shadowing\">ê¸°ë³¸ì ìœ¼ë¡œ ë¶ˆë³€ì„± &#x26; ì„€ë„ì‰ (Immutability by default &#x26; shadowing)</a></li>\n<li><a href=\"#no-null\">No null!</a></li>\n<li><a href=\"#%EC%9D%BC%EA%B8%89-%EC%97%B4%EA%B1%B0%ED%98%95enum-%EC%A7%80%EC%9B%90\">ì¼ê¸‰ ì—´ê±°í˜•(Enum) ì§€ì›</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%8A%B9%EC%84%B1-traits\">íŠ¹ì„± (Traits)</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EB%A1%A0\">ê²°ë¡ </a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B6%9C%EC%B2%98\">ì¶œì²˜</a></p>\n</li>\n</ul>"}}},
    "staticQueryHashes": ["1137390604","3980716358"]}